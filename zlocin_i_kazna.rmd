---
title: "Zločin i kazna - analiza kriminala"
author: Luka Mucko, Filip Pankretić, Matej Lopotar, Tomislav Žiger
output: html_document
---
## Motivacija i opis problema
Recidivizam je jedan od temeljnih pojmova u kaznenom pravosudu koji se odnosi na kriminalno ponašanje
nakon što je osoba već kažnjena zbog prethodnog. Recidivizmom se smatra ponavljanje bilo kakvog kaznenog
djela koje rezultira ponovnim uhićenjem ili ponovnom osudom tijekom razdoblja od tri godine nakon puštanja
osobe na slobodu. Zbog opće sigurnosti, a i razvoja novih strategija za reintegraciju (bivših) osuđenika, bitno
je proučiti i razumjeti koji čimbenici su učestaliji kod ponavljača zločina.
<br>
**Prvo ćemo odgovoriti na zadana pitanja, zatim ispitivati vlastite hipoteze.** <br>
Učitajmo podatke:

```{r warning = FALSE}
recidivism_full <- read.csv("recidivism_full.csv")
```
```{r include = FALSE}
library("plyr")
library("foreach")
```
# Postoji li razlika u duljini zatvorske kazne s obzirom na razinu obrazovanja?

U tablici podataka imamo stupce "prison_years" i "education_level" <br>
"prison_years" poprima vrijednosti:
```{r}
for (v in unique(recidivism_full$Prison_Years)){
  print(v)
}
```
Imamo 4 klase duljine zatvorske kazne. <br>

"education_level" poprima vrijednosti:
```{r}
for (v in unique(recidivism_full$Education_Level)){
  print(v)
}
```
Vidimo da imamo 3 klase razine obrazovanja. <br><br>

Uz poznavanje jedinstvenih vrijednosti "education_level" i "prison_years" možemo pronaći kontingencijsku tablicu:
```{r}
contingency_table<-table(recidivism_full$Education_Level, recidivism_full$Prison_Years)
print(contingency_table)
```
Znajući kontingencijsku tablicu postavljamo hipoteze $H_0$ i $H_1$ <br>

$H_0:$ Proporcije zatvorenih za neku klasu iz "education_level" naspram ukupnog broja zatvorenih u nekoj klasi iz "prison_years" je jednak za svaku klasu iz "prison_years".  Drugim riječima:<br> <br>
Neka je $A = \text{"kontingencijska tablica"}$ i numerirajmo retke i stupce tablice A brojevima i={1,2,3} odnosno j={1,2,3,4}. <br>
Neka je $P_{ij} = \frac{A_{ij}}{\sum_{i=1}^{3} A_{ij}}$ (vidi ispis koda 5.)<br>
$H_0: p_{ij}=p_{ik} \  \forall i \in \{1,2,3\},\  \forall j,k \in \{1,2,3,4\}\  j \neq k$ <br>
$H_1: p_{ij}\neq p_{ik}\  ...$ <br>
Možemo testirati hipotezu $H_0\  \text{odnosno} \ H_1$ koristeći $\chi ^2$ test o jednakosti proporcija.
```{r}
chisq.test(contingency_table)
```
Vidimo da je vrijednost testne statistike 223.12 i p-vrijednost $< 2.2 \times 10^{-16}$ što je značajno
manje od $p << \alpha = 0.05$. <br>
Dakle zaključujemo da **postoji razlika u duljini zatvorske kazne s obzirom na razinu obrazovanja!!**

# Jesu li mlađe dobne skupine podložnije ponavljanju kriminala od starijih?
označimo s $p_m$ i $p_s$ proporciju broja zatvorenika koji su ponovili kriminal i broja "starijih" odnosno "mlađih" zatvorenika.
U tablici jedino imamo "age_at_release" koji predstavlja dob u kojoj su pušteni na slobodu.
Po tome ćemo mjeriti starost.
```{r}
for (v in sort(unique(recidivism_full$Age_at_Release))){
  print(v)
}
```
Neka su "mlađi" svi do "33-37" isključivo. To nam daje ukupne populacije
```{r}
table <- count(recidivism_full$Age_at_Release)
mladi <- sum(table[1:3,"freq"])
stari <- sum(table[,"freq"])-mladi
print(table)
sprintf("Broj mladih je: %s",mladi)
sprintf("Broj starijih je: %s",stari)
```
Za mjeru ponovljenog kriminala koristit ćemo Recidivizam. <br>
Postoje 3 stupca u tablici koji nam govore je li je zatvorenik počinio zločin nako puštanja na slobodu. To su: Recidivism_Within_3years, Recidivism_Arrest_Year1, Recidivism_Arrest_Year2, Recidivism_Arrest_Year3. 0=no/1=yes<br>
Stoga možemo prebrojati sve one koji su ponovno počinili zločin.
```{r}
ponovljeni_mladi <- nrow(subset(recidivism_full, Age_at_Release %in% c("18-22","23-27","28-32")  & (Recidivism_Within_3years | Recidivism_Arrest_Year1 | Recidivism_Arrest_Year2 | Recidivism_Arrest_Year3)))
ponovljeni_stari <- nrow(subset(recidivism_full, Age_at_Release %in% c("33-37","38-42","43-47","48 or older")  & (Recidivism_Within_3years | Recidivism_Arrest_Year1 | Recidivism_Arrest_Year2 | Recidivism_Arrest_Year3)))
cat("Broj mladih/starih koji su ponovili zločin:",ponovljeni_mladi,ponovljeni_stari)

```
Poznavajuči brojeve možemo odrediti $p_s$ i $p_m$
```{r}
Pm <- ponovljeni_mladi/mladi
Ps <- ponovljeni_stari/stari
```
Provedimo test:
```{r}
rez <- prop.test(c(ponovljeni_mladi,ponovljeni_stari),c(mladi,stari), alternative="greater")
rez
rez$p.value
```
Dobivamo p-vrijednost $3.7478 \times 10^{-123}$ što je puno manje od nivoa značajnosti $\alpha = 0.05$. **Stoga odbacujemo nultu hipotezu u korist alternative i statistički zaključujemo uz značaj 0.05 da zatvorenici pušteni u svojoj "mladosti" skloniji ponavljanju kriminala.**

